<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>üçΩÔ∏è Helper de Receitas</title>
<style>
  :root{
    --mid-bg: #2e231f;
    --left-bg: #4b3a33;
    --right-bg: #6b564c;
    --text: #f4f4f4;
    --accent: #ffcc00;
    --muted: #bfb0a6;
  }
  body{
    margin:0;
    height:100vh;
    display:flex;
    font-family: Arial, sans-serif;
    background: var(--left-bg);
    color: var(--text);
  }

  /* esquerda - lista de receitas */
  #lista-receitas {
    flex: 1;
    background: var(--left-bg);
    overflow-y:auto;
    padding: 12px;
    box-sizing: border-box;
  }
  .receita-item {
    display:flex;
    gap:10px;
    align-items:center;
    padding:8px;
    border-bottom:1px solid rgba(0,0,0,0.12);
    cursor:pointer;
  }
  .receita-item img { width:44px; height:44px; object-fit:contain; background:transparent; border-radius:6px; }

  .receita-nome { font-weight:700; }
  .receita-meta { font-size:13px; color: var(--muted); }

  /* meio - detalhes */
  #detalhes {
    flex: 2;
    background: var(--mid-bg);
    padding: 14px;
    box-sizing: border-box;
    overflow-y:auto;
  }
  #nome-receita { margin:0 0 4px 0; font-size:20px; }
  #meta-receita {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    margin: 2px 0 10px 0;
    font-size: 14px;
    color: var(--accent);
    font-weight: 600;
  }

  .ingrediente {
    background: rgba(255,255,255,0.03);
    padding:8px;
    border-radius:6px;
    margin-bottom:8px;
  }

  .ingrediente-top {
    display:flex;
    align-items:center;
    gap:10px;
  }
  .ingrediente-top img { width:32px; height:32px; object-fit:contain; background:transparent; border-radius:4px; }

  .qtd-base { color:var(--muted); margin-right:6px; }
  .nome { font-weight:700; color:var(--text); margin-right:8px; }

  .qtd-desejada {
    color: var(--accent);
    font-weight:700;
    font-size:1.5em;
    margin-left:auto;
    text-shadow: 0 0 1px #000;
    letter-spacing: 0.5px;
  }

  .ingrediente-valores {
    font-size:13px;
    color: var(--muted);
    margin-left:46px;
    margin-top:6px;
  }

  /* direita - painel */
  #painel {
    flex: 1;
    background: var(--right-bg);
    padding:12px;
    box-sizing:border-box;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .painel-box {
    background: rgba(0,0,0,0.05);
    padding:10px;
    border-radius:8px;
    color: var(--text);
    font-size:16px; /* Fonte maior */
  }
  .painel-box strong {
    font-size:18px;
    color: var(--accent);
  }
  input[type="number"]{ width:100%; padding:8px; border-radius:6px; border: none; outline:none; font-size:14px; }

  .small-muted { color: var(--muted); }

  /* responsivo simples */
  @media(max-width:900px){
    body { flex-direction: column; height: auto; }
    #lista-receitas, #detalhes, #painel { width:100%; }
    .receita-meta { margin-left:0; margin-top:4px; }
    .qtd-desejada { margin-left:8px; }
    .ingrediente-valores { margin-left:42px; }
  }
</style>
</head>
<body>

  <div id="lista-receitas" aria-label="Lista de receitas"></div>

  <div id="detalhes">
    <h2 id="nome-receita">Selecione uma receita</h2>
    <p id="meta-receita" class="small-muted"></p>
    <div id="ingredientes-lista"></div>
  </div>

  <div id="painel" aria-label="Painel de c√°lculos">
    <div class="painel-box small-muted">
     üì¶ Quantidade (1‚Äì100)
      <input type="number" id="qtd" min="1" max="100" value="1">
    </div>

    <div class="painel-box small-muted">
     ‚öôÔ∏è Custo unit√°rio (1 unidade): <strong id="custo-unit">…É 0</strong>
    </div>

    <div class="painel-box small-muted">
     üßÆ Custo total: <strong id="custo-total">…É 0</strong>
    </div>

    <div class="painel-box small-muted">
     üßæ Taxa (3%): <strong id="taxa">…É 0</strong>
    </div>

    <div class="painel-box small-muted">
     üí∞ Pre√ßo de venda (por unidade)
      <input type="number" id="preco-venda" value="0" step="0.01" min="0">
    </div>

    <div class="painel-box small-muted">
     ü§ë Lucro: <strong id="lucro">…É 0</strong>
    </div>
  </div>

<script>
const FMT = new Intl.NumberFormat('pt-BR');
const MON = '…É';
const clamp = (n, min, max) => Math.max(min, Math.min(max, n));
function money(n){ n = Number(n)||0; return MON + ' ' + FMT.format(Math.round(n)); }

let itens = [];
let itensById = new Map();
let receitas = [];
let receitaSelecionada = null;

const spriteCache = new Map();
async function getSpriteURL(url){
  if(!url) return '';
  if(spriteCache.has(url)) return spriteCache.get(url);
  const p = fetch(url)
    .then(r => { if(!r.ok) throw new Error('HTTP'); return r.blob(); })
    .then(blob => URL.createObjectURL(blob))
    .catch(() => '');
  spriteCache.set(url, p);
  return p;
}
function setImg(imgEl, url){
  if(!url){ imgEl.src=''; imgEl.style.background='#887'; return; }
  getSpriteURL(url).then(src => {
    if(src){ imgEl.src = src; imgEl.style.background='transparent'; }
    else { imgEl.src=''; imgEl.style.background='#887'; }
  });
}

let ingredienteNodes = [];
let custoUnitAtual = 0;

async function carregar(){
  try{
    const r1 = await fetch('itens.json');
    if(!r1.ok) throw new Error('itens.json n√£o encontrado / erro HTTP');
    itens = await r1.json();
    itensById = new Map(itens.map(it => [Number(it.id), it]));

    const r2 = await fetch('receitas.json');
    if(!r2.ok) throw new Error('receitas.json n√£o encontrado / erro HTTP');
    receitas = await r2.json();

    montarListaReceitas();
  }catch(err){
    alert('Erro ao carregar arquivos: ' + err.message + '\nVer console para mais detalhes.');
    console.error(err);
  }
}

function montarListaReceitas(){
  const lista = document.getElementById('lista-receitas');
  lista.innerHTML = '';
  receitas.forEach((r) => {
    const item = document.createElement('div');
    item.className = 'receita-item';

    const img = document.createElement('img');
    img.loading = 'lazy';
    img.alt = r.nome || 'Sprite da receita';
    setImg(img, r.sprite);

    const txt = document.createElement('div');
    const nivel = (r.level ?? '‚Äî');
    const cd = (r.cooldown ?? '‚Äî');
    txt.innerHTML = `
      <div class="receita-nome">${r.nome}</div>
      <div class="receita-meta">N√≠vel ${nivel} ‚Äî ${cd}s</div>
    `;

    item.appendChild(img);
    item.appendChild(txt);
    item.onclick = () => selecionarReceita(r);
    lista.appendChild(item);
  });
}

function construirIngredientes(r){
  const box = document.getElementById('ingredientes-lista');
  box.innerHTML = '';
