<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Helper de Receitas</title>
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    margin: 0;
    background: #4b3a33;
    color: #f4f4f4;
  }
  #lista-receitas {
    flex: 1;
    background: #6b564c;
    overflow-y: auto;
    padding: 10px;
  }
  .receita-item {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 5px;
    border-bottom: 1px solid #a89284;
  }
  .receita-item img {
    width: 40px;
    height: 40px;
    object-fit: contain;
  }
  #detalhes {
    flex: 2;
    background: #2e231f;
    padding: 10px;
  }
  .ingrediente {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 3px 0;
  }
  .ingrediente img {
    width: 32px;
    height: 32px;
    object-fit: contain;
  }
  #painel {
    flex: 1;
    background: #8a7368;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .painel-box {
    background: #6b564c;
    padding: 10px;
    border-radius: 8px;
  }
  input[type="number"] {
    width: 100%;
    padding: 5px;
  }
</style>
</head>
<body>

<div id="lista-receitas"></div>

<div id="detalhes">
  <h2 id="nome-receita"></h2>
  <div id="ingredientes-lista"></div>
</div>

<div id="painel">
  <div class="painel-box">
    Quantidade:
    <input type="number" id="qtd" min="1" max="100" value="1">
  </div>
  <div class="painel-box">Custo total: <span id="custo-total">Ƀ 0</span></div>
  <div class="painel-box">Preço de venda (individual): <input type="number" id="preco-venda" value="0"></div>
  <div class="painel-box">Lucro: <span id="lucro">Ƀ 0</span></div>
</div>

<script>
let itens = [];
let receitas = [];
let receitaSelecionada = null;

fetch('itens.json')
  .then(res => res.json())
  .then(data => {
    itens = data;
    return fetch('receitas.json');
  })
  .then(res => res.json())
  .then(data => {
    receitas = data;
    carregarReceitas();
  });

function carregarReceitas() {
  const lista = document.getElementById('lista-receitas');
  lista.innerHTML = '';
  receitas.forEach(r => {
    const div = document.createElement('div');
    div.className = 'receita-item';
    div.innerHTML = `<img src="${r.sprite}" alt=""> <span>${r.nome}</span>`;
    div.onclick = () => selecionarReceita(r);
    lista.appendChild(div);
  });
}

function selecionarReceita(receita) {
  receitaSelecionada = receita;
  document.getElementById('nome-receita').innerText = receita.nome;
  const listaIng = document.getElementById('ingredientes-lista');
  listaIng.innerHTML = '';
  receita.ingredientes.forEach(ing => {
    const itemInfo = itens.find(i => i.id === ing.id);
    if (!itemInfo) return;
    const div = document.createElement('div');
    div.className = 'ingrediente';
    const qtdBase = ing.quantidade;
    const qtdNecessaria = qtdBase * (parseInt(document.getElementById('qtd').value) || 1);
    const valorUnit = itemInfo.valor;
    const valorTotal = valorUnit * qtdNecessaria;
    div.innerHTML = `
      <img src="${itemInfo.sprite}" alt="">
      (${qtdBase}) - <strong>${itemInfo.nome}</strong> - <strong>${qtdNecessaria}</strong> × Ƀ ${valorUnit.toLocaleString('pt-BR')} = Ƀ ${valorTotal.toLocaleString('pt-BR')}
    `;
    listaIng.appendChild(div);
  });
  atualizarCusto();
}

function atualizarCusto() {
  if (!receitaSelecionada) return;
  const qtd = parseInt(document.getElementById('qtd').value) || 1;
  let custo = 0;
  const listaIng = document.getElementById('ingredientes-lista');
  listaIng.innerHTML = '';
  receitaSelecionada.ingredientes.forEach(ing => {
    const itemInfo = itens.find(i => i.id === ing.id);
    if (itemInfo) {
      const qtdBase = ing.quantidade;
      const qtdNecessaria = qtdBase * qtd;
      const valorUnit = itemInfo.valor;
      const valorTotal = valorUnit * qtdNecessaria;
      custo += valorTotal;
      const div = document.createElement('div');
      div.className = 'ingrediente';
      div.innerHTML = `
        <img src="${itemInfo.sprite}" alt="">
        (${qtdBase}) - <strong>${itemInfo.nome}</strong> - <strong>${qtdNecessaria}</strong> × Ƀ ${valorUnit.toLocaleString('pt-BR')} = Ƀ ${valorTotal.toLocaleString('pt-BR')}
      `;
      listaIng.appendChild(div);
    }
  });
  document.getElementById('custo-total').innerText = "Ƀ " + custo.toLocaleString('pt-BR');
  const precoVenda = parseInt(document.getElementById('preco-venda').value) || 0;
  const lucro = (precoVenda - (custo / qtd)) * qtd;
  document.getElementById('lucro').innerText = "Ƀ " + lucro.toLocaleString('pt-BR');
}

document.getElementById('qtd').addEventListener('input', atualizarCusto);
document.getElementById('preco-venda').addEventListener('input', atualizarCusto);
</script>

</body>
</html>
