<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>Helper de Receitas</title>
<style>
  :root{
    --mid-bg: #2e231f;   /* fundo do meio (requisitado) */
    --left-bg: #4b3a33;  /* variação mais clara */
    --right-bg: #6b564c; /* variação mais clara */
    --text: #f4f4f4;
    --accent: #ffcc00;   /* destaque qtd */
    --muted: #bfb0a6;
  }
  body{
    margin:0;
    height:100vh;
    display:flex;
    font-family: Arial, sans-serif;
    background: var(--left-bg);
    color: var(--text);
  }

  /* esquerda - lista de receitas */
  #lista-receitas {
    flex: 1;
    background: var(--left-bg);
    overflow-y:auto;
    padding: 12px;
    box-sizing: border-box;
  }
  .receita-item {
    display:flex;
    gap:10px;
    align-items:center;
    padding:8px;
    border-bottom:1px solid rgba(0,0,0,0.12);
    cursor:pointer;
  }
  .receita-item img { width:44px; height:44px; object-fit:contain; background:transparent; border-radius:6px; }

  .receita-nome { font-weight:700; }
  .receita-meta { font-size:13px; color: var(--muted); margin-left:54px; margin-top:-6px; }

  /* meio - detalhes */
  #detalhes {
    flex: 2;
    background: var(--mid-bg);
    padding: 14px;
    box-sizing: border-box;
    overflow-y:auto;
  }
  #nome-receita { margin:0 0 8px 0; font-size:20px; }

  .ingrediente {
    background: rgba(255,255,255,0.03);
    padding:8px;
    border-radius:6px;
    margin-bottom:8px;
  }

  .ingrediente-top {
    display:flex;
    align-items:center;
    gap:10px;
  }
  .ingrediente-top img { width:32px; height:32px; object-fit:contain; background:transparent; border-radius:4px; }

  .qtd-base { color:var(--muted); margin-right:6px; }
  .nome { font-weight:700; color:var(--text); margin-right:8px; }

  .qtd-desejada {
    color: var(--accent);
    font-weight:700;
    font-size:1.05em;
    margin-left:auto; /* empurra para a direita */
  }

  .ingrediente-valores {
    font-size:13px;
    color: var(--muted);
    margin-left:46px; /* alinha com texto (após sprite) */
    margin-top:6px;
  }

  /* direita - painel */
  #painel {
    flex: 1;
    background: var(--right-bg);
    padding:12px;
    box-sizing:border-box;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .painel-box {
    background: rgba(0,0,0,0.05);
    padding:10px;
    border-radius:8px;
    color: var(--text);
  }
  input[type="number"]{ width:100%; padding:8px; border-radius:6px; border: none; outline:none; font-size:14px; }

  .small-muted { color: var(--muted); font-size:13px; }

  /* responsivo simples */
  @media(max-width:900px){
    body { flex-direction: column; height: auto; }
    #lista-receitas, #detalhes, #painel { width:100%; }
    .receita-meta { margin-left:0; margin-top:4px; }
    .qtd-desejada { margin-left:8px; }
    .ingrediente-valores { margin-left:42px; }
  }
</style>
</head>
<body>

  <div id="lista-receitas" aria-label="Lista de receitas"></div>

  <div id="detalhes">
    <h2 id="nome-receita">Selecione uma receita</h2>
    <div id="ingredientes-lista"></div>
  </div>

  <div id="painel" aria-label="Painel de cálculos">
    <div class="painel-box small-muted">
      Quantidade (1–100)
      <input type="number" id="qtd" min="1" max="100" value="1">
    </div>

    <div class="painel-box small-muted">
      Custo unitário (1 unidade): <strong id="custo-unit">Ƀ 0</strong>
    </div>

    <div class="painel-box small-muted">
      Custo total: <strong id="custo-total">Ƀ 0</strong>
    </div>

    <div class="painel-box small-muted">
      Preço de venda (por unidade)
      <input type="number" id="preco-venda" value="0" step="0.01" min="0">
    </div>

    <div class="painel-box small-muted">
      Lucro: <strong id="lucro">Ƀ 0</strong>
    </div>
  </div>

<script>
/* util */
const FMT = new Intl.NumberFormat('pt-BR');
const MON = 'Ƀ';
function money(n){ n = Number(n)||0; return MON + ' ' + FMT.format(Math.round(n)); }

/* dados carregados */
let itens = [];
let receitas = [];
let receitaSelecionada = null;

async function carregar(){
  try{
    const r1 = await fetch('itens.json');
    if(!r1.ok) throw new Error('itens.json não encontrado / erro HTTP');
    itens = await r1.json();

    const r2 = await fetch('receitas.json');
    if(!r2.ok) throw new Error('receitas.json não encontrado / erro HTTP');
    receitas = await r2.json();

    montarListaReceitas();
  }catch(err){
    alert('Erro ao carregar arquivos: ' + err.message + '\nVer console para mais detalhes.');
    console.error(err);
  }
}

/* monta lista esquerda: usa r.level e r.cooldown vindos do receitas.json */
function montarListaReceitas(){
  const lista = document.getElementById('lista-receitas');
  lista.innerHTML = '';
  receitas.forEach((r, idx) => {
    const item = document.createElement('div');
    item.className = 'receita-item';
    const img = document.createElement('img');
    img.src = r.sprite || '';
    img.alt = r.nome;
    img.onerror = () => { img.style.background='#887'; img.src=''; };
    const txt = document.createElement('div');
    txt.innerHTML = `<div class="receita-nome">${r.nome}</div>
                     <div class="receita-meta">Nível ${r.level ?? '—'} — ${r.cooldown ?? '—'}s</div>`;
    item.appendChild(img);
    item.appendChild(txt);
    item.onclick = () => selecionarReceita(r);
    lista.appendChild(item);
  });
}

/* render ingredientes (duas linhas) */
function renderIngredientes(){
  const box = document.getElementById('ingredientes-lista');
  box.innerHTML = '';
  if(!receitaSelecionada) return;
  const qtd = Number(document.getElementById('qtd').value) || 1;

  receitaSelecionada.ingredientes.forEach(ing => {
    const itemInfo = itens.find(it => Number(it.id) === Number(ing.id));
    const div = document.createElement('div');
    div.className = 'ingrediente';

    const top = document.createElement('div');
    top.className = 'ingrediente-top';

    const img = document.createElement('img');
    if(itemInfo && itemInfo.sprite){
      img.src = itemInfo.sprite;
      img.onerror = () => { img.style.background='#887'; img.src=''; };
    } else {
      img.style.background = '#887';
    }

    const qtdBaseSpan = document.createElement('span');
    qtdBaseSpan.className = 'qtd-base';
    qtdBaseSpan.textContent = `(${ing.quantidade})`;

    const nomeSpan = document.createElement('span');
    nomeSpan.className = 'nome';
    nomeSpan.textContent = itemInfo ? itemInfo.nome : `Item id ${ing.id} não encontrado`;

    const qtdDesejadaSpan = document.createElement('span');
    qtdDesejadaSpan.className = 'qtd-desejada';
    const qtdTotal = Number(ing.quantidade) * qtd;
    qtdDesejadaSpan.textContent = qtdTotal;

    top.appendChild(img);
    top.appendChild(qtdBaseSpan);
    top.appendChild(nomeSpan);
    top.appendChild(qtdDesejadaSpan);

    const bottom = document.createElement('div');
    bottom.className = 'ingrediente-valores';

    const valorUnit = itemInfo ? Number(itemInfo.valor) || 0 : 0;
    const valorTotal = valorUnit * qtdTotal;

    bottom.textContent = `${MON} ${FMT.format(valorUnit)} = ${MON} ${FMT.format(Math.round(valorTotal))}`;

    div.appendChild(top);
    div.appendChild(bottom);
    box.appendChild(div);
  });
}

/* selecionar receita */
function selecionarReceita(r){
  receitaSelecionada = r;
  document.getElementById('nome-receita').textContent = r.nome;
  renderIngredientes();
  atualizarCusto(); // popula custos e lucro
}

/* calcula custo unitário (1 unidade), custo total (qtd) e lucro: (precoVendaUnit - custoUnit) * qtd */
function atualizarCusto(){
  if(!receitaSelecionada) return;
  const qtd = Number(document.getElementById('qtd').value) || 1;
  // custo unitário = soma(valor_unit * qtd_base)
  let custoUnit = 0;
  receitaSelecionada.ingredientes.forEach(ing => {
    const it = itens.find(x => Number(x.id) === Number(ing.id));
    if(it && Number.isFinite(Number(it.valor))) {
      custoUnit += Number(it.valor) * Number(ing.quantidade);
    }
  });
  const custoTotal = custoUnit * qtd;
  document.getElementById('custo-unit').textContent = MON + ' ' + FMT.format(Math.round(custoUnit));
  document.getElementById('custo-total').textContent = MON + ' ' + FMT.format(Math.round(custoTotal));

  const vendaUnit = Number(document.getElementById('preco-venda').value) || 0;
  const lucro = (vendaUnit - custoUnit) * qtd;
  document.getElementById('lucro').textContent = MON + ' ' + FMT.format(Math.round(lucro));

  // atualiza lista no meio (qtd desejada e valores)
  renderIngredientes();
}

/* listeners */
document.getElementById('qtd').addEventListener('input', atualizarCusto);
document.getElementById('preco-venda').addEventListener('input', atualizarCusto);

/* start */
carregar();
</script>

</body>
</html>
